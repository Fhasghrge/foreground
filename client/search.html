<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>FOREGROUNDING</title>
	<link rel="stylesheet" href="css/styles.css">
</head>

<body>
	<header>
		<div class="topbox">
			<div class="logo"><a href="index.html">FOREGROUNDING</a></div>
			<div class="webtitle" style="padding-top:8px; padding-bottom:8px;">Case
				Study</div>
			<div class="menu">

				<div class="zmenu">

					<a href="index.html">Home Page</a>
					<a href="theory.html">Theory<BR>
						Development</a>
					<a href="classification.html">Classification<BR>
						of Foregrounding</a>
					<a href="case.html">Case Study</a>
					<a href="message.html">Message Board</a>

				</div>
				<img src="images/icon_list.png">
			</div>

		</div>
	</header>

	<div class="width">

		<!--<div class="searchtitle">Grammatical Deviation</div>-->
		<div class="searchbox">
			<form action="search.html" method="get">
				<input name="key" type="text" class="searchinput" value="Search for Parallelism or Deviation">
				<input name="go" type="image" src="images/search.png">
			</form>
		</div>


		<div id="container" class="searchcontext">
		</div>

	</div>

	<br>
	<br>
	<script src="js/jquery-1.10.1.js"></script>
	<script>

		function getUrl() {
			var url = location.search;
			var theRequest = new Object();
			if (url.indexOf("?") != -1) {
				var str = url.substr(1);
				strs = str.split("&");
				for (var i = 0; i < strs.length; i++) {
					theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
				}
			}
			return theRequest;
		}

		var get_url = getUrl();
		key = get_url["key"];
		fetch(`/api/search?keyword=${key}`)
			.then(res => res.json())
			.then(res => {
				if (!res.data?.length) {
					$('#container').html(`
					<div class="context error">
						<p>No Result!</p>
						<p>You can search for keywords:</p>
						<p>grammatical deviation, semantic deviation, deviation of register, parallel structure ,repetition</p>
					</div>
				`)
					return
				}
				let htmlStr = '';
				res.data.forEach(({ keywords, ch, eng }, index) => {
					htmlStr += `
					<div class="context">
						<p>${keywords} Example ${index+1}：</p>
						<p>${ch}</p>
						<p>${eng}</p>
					</div>
					`
				})
				$('#container').html(htmlStr);
			})

		// grammatical deviation, semantic deviation, deviation of register, parallel structure ，repetition
		keyclass = key.split("+")[0].toLowerCase();

		if (keyclass != "grammatical" && keyclass != "semantic" && keyclass != "deviation" && keyclass != "parallel" && keyclass != "repetition") {
			keyclass = "error"
		}

		$(document).ready(function () {
			$(".context").hide()
			$("." + keyclass).show()
			$(".searchtitle").html(key.replace("+", " "))
			$(".searchinput").val(key.replace("+", " "))

		});


	</script>
</body>

</html>
